<!DOCTYPE html>
<html lang="en-US">

<head>

<title>${product} - ${name} - Summary</title>

<link rel="stylesheet" type="text/css" href="${root_url}/css/normalize.css">
<link rel="stylesheet" type="text/css" href="${root_url}/css/site.css">

<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">

<link rel="shortcut icon" href="${root_url}/media/favicon.ico" >

</head>

<style type="text/css">
	html { height: 100% }
	body { height: 100%; margin: 0; padding: 0 }
	div { margin: 0px }
	#map_canvas { height: 75% }
</style>

<body>

<section class="nav">
${nav}
</section>

<div class="map_canvas" id="map_canvas">
</div>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.slim.js" integrity="sha256-tA8y0XqiwnpwmOIl3SGAcFl2RvxHjA8qp0+1uCGmRmg=" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/openlayers/4.6.5/ol.js" integrity="sha256-77IKwU93jwIX7zmgEBfYGHcmeO0Fx2MoWB/ooh9QkBA=" crossorigin="anonymous"></script>

<script type="text/javascript">
	var map

	function escapeRegExp(str)
	{
		return str.replace(/([.*+?^=!:${}()|\[\]\/\\])/g, "\\$1");
	}

	function replaceAll(str, find, replace)
	{
		return str.replace(new RegExp(escapeRegExp(find), 'g'), replace);
	}

	function newCoord(x, y)
	{
		return new OpenLayers.LonLat(x, y);
	}

	function initialize()
	{
        var source = new ol.source.Vector({
            url: '${root_url}/data/us_states.geo.json',
            format: new ol.format.GeoJSON()
        });
        var clusterSource = new ol.source.Cluster({
            distance: 40,
            source: source
        });
        var styleCache = {};
        var clusters = new ol.layer.Vector({
            source: clusterSource,
            style: function(feature, resolution) {
                var size = feature.get('features').length;
                var style = styleCache[size];
                if (!style)
                {
                    style = [new ol.style.Style({
                        image: new ol.style.Circle({
                            radius: 10,
                            stroke: new ol.style.Stroke({
                                color: '#fff'
                            }),
                            fill: new ol.style.Fill({
                                color: '#3399CC'
                            })
                        }),
                    })];
                    styleCache[size] = style;
                }
                return style;
            }
        });
        var raster = new ol.layer.Tile({
            source: new ol.source.OSM()
        });
        var raw = new ol.layer.Vector({
            source: source
        });
        var map = new ol.Map({
            layers: [raster, clusters],
            renderer: 'canvas',
            target: 'map_canvas',
            view: new ol.View({
                center: [0, 0],
                zoom: 2
            })
        });
	}

	initialize();
</script>

</body>

</html>
