<!DOCTYPE html>
<html lang="en-US">

<head>

<title>${product} - ${name}</title>

<script type="text/javascript" src="${root_url}/js/all.js"></script>
<link rel="stylesheet" href="${root_url}/css/normalize.css">
<link rel="stylesheet" href="${root_url}/css/site.css">

<meta charset="UTF-8">
<meta name="description" content="Lists all activities belonging to the logged in user">
<meta name="keywords" content="activity list,calendar view">

</head>

<link rel="shortcut icon" href="${root_url}/media/favicon.ico" >

<body>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.css">
<link rel="stylesheet" media="print" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.print.min.css">

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.js"></script>

<script type="text/javascript" src="${root_url}/js/all.js"></script>
<script type="text/javascript">

	function handleVisibilityClick(cb, activity_id)
	{
		var the_url = "${root_url}/api/1.0/update_visibility";
		var dict = [];
		var result_text = {};
		var is_public = $('#' + cb.id).is(':checked') ? "public" : "private";

		dict.push({["activity_id"] : activity_id});
		dict.push({["visibility"] : is_public});
		if (send_post_request(the_url, dict, result_text))
		{
			if (is_public) {
				$('#' + cb.id + "+span").html('Public');
			} else {
				$('#' + cb.id + "+span").html('Private');
			}
		}
		else
		{
			alert(result_text.value);
		}
	}

	function on_delete(activity_id)
	{
		if (confirm('Are you sure you want to do this?'))
		{
			var the_url = "${root_url}/api/1.0/delete_activity";
			var dict = [];
			var result_text = {};

			dict.push({["activity_id"] : activity_id});
			if (send_post_request(the_url, dict, result_text))
			{
				window.location.replace("${root_url}/my_activities");
			}
			else
			{
				alert(result_text.value);
			}
		}
	}

	function list_activities()
	{
		var activity_list = [];
		var the_url = "${root_url}/api/1.0/list_activities";
		var dict = [];
		var result_text = {};

		if (send_post_request(the_url, dict, result_text))
		{
			var obj = JSON.parse(result_text.value);
			for (var i = 0; i < obj.length; i++)
			{
				var activity_obj = obj[i];
				activity_obj['start'] = unix_time_to_iso_time(activity_obj['time']);
                activity_obj['color'] = 'DarkTurquoise';
				activity_list.push(activity_obj);
			}
		}
		else
		{
			alert(result_text.value);
		}

		return activity_list;
	}

	function list_workouts()
	{
		var workout_list = [];
		var the_url = "${root_url}/api/1.0/list_workouts";
		var dict = [];
		var result_text = {};

		if (send_post_request(the_url, dict, result_text))
		{
			var obj = JSON.parse(result_text.value);
			for (var i = 0; i < obj.length; i++)
			{
				var workout_obj = obj[i];
				workout_obj['start'] = unix_time_to_iso_time(workout_obj['time']);
                workout_obj['color'] = 'Tomato';
				workout_list.push(workout_obj);
			}
		}
		else
		{
			alert(result_text.value);
		}

		return workout_list;
	}

	function list_calendar_events()
	{
        activities = list_activities();
        workouts = list_workouts();
        return activities.concat(workouts);
    }

	$(document).ready(function()
	{
		$('#calendar').fullCalendar({
			header: {
				left: 'prev,next,today',
				center: 'title',
				right: 'month,agendaWeek,agendaDay,listWeek'
			},
			navLinks: true, // can click day/week names to navigate views
			editable: false,
			eventLimit: true, // allow "more" link when too many events
			timezone: 'local',
			events: list_calendar_events()
		});

		$('#prev').on('click', function() {
			$('#calendar').fullCalendar('prev'); // call method
		});

		$('#next').on('click', function() {
			$('#calendar').fullCalendar('next'); // call method
		});
	});

</script>

<section class="nav">
${nav}
</section>

<section>
<div id='calendar'></div>
</section>

</body>
</html>
