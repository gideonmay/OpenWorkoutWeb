<!DOCTYPE html>
<html lang="en-US">

<head>

<title>${product} - ${name}</title>

<link rel="stylesheet" href="${root_url}/css/normalize.css">
<link rel="stylesheet" href="${root_url}/css/site.css">

<meta charset="UTF-8">
<meta name="description" content="Lists all devices claimed by the logged in user">
<meta name="keywords" content="device list">

</head>

<link rel="shortcut icon" href="${root_url}/media/favicon.ico" >

<body>

<script type="text/javascript" src="${root_url}/js/all.js"></script>
<script>
    function update_activity_metadata()
    {
		var the_url = "${root_url}/api/1.0/update_activity_metadata";
		var activity_name = document.getElementById("activity_name").value;
		var activity_type = document.getElementById("activity_type").value;
		var description = document.getElementById("description").value;
		var dict = [];
		var result_text = {};

		dict.push({["activity_id"] : "${activity_id}"});
		dict.push({["name"] : activity_name});
		dict.push({["activity_type"] : activity_type});
		dict.push({["description"] : description});

		if (send_post_request(the_url, dict, result_text))
            window.location.replace("${root_url}/activity/${activity_id}");
		else
			alert("An error occurred!");
    }
</script>

<section class="nav">
${nav}
</section>

<div class="profile" style="width: 600px">
	<h2>Activity Name</h2>
	<input type="text" name="activity_name" id="activity_name" value="${activity_name}" size="80"><br>
	<hr>
	<h2>Activity Type</h2>
	<select id="activity_type" >
${activity_type_options}
	</select><br>
	<hr>
	<h2>Description</h2>
	<textarea id="description" rows="10" cols="82">${description}</textarea>
    <br>
	<button type="button" id="update" onclick="return update_activity_metadata()">Update</button>
    <hr>
	<h2>Photos</h2>
	<input type="file" id="picker" class="modern_button" name="file_list" webkitdirectory multiple><br>
	<br>
    <table class="import" id="upload_table">
    </table>

	<script>
		let picker = document.getElementById('picker');
		let selected_file_list = [];

        function upload_file(file_obj)
        {
            var reader = new FileReader();

            reader.onerror = function(event)
            {
                reader.abort();
            };
            reader.onload = function(e)
            {
                var the_url = "${root_url}/api/1.0/upload_activity_photo?${activity_id}";
                var dict = [];
                var result_text = {};
                var encoded_data = btoa(reader.result);

                dict.push({["uploaded_file_data"] : encoded_data});
        		dict.push({["activity_id"] : "${activity_id}"});

                if (send_post_request(the_url, dict, result_text))
                {
                }
                else
                {
                    alert(result_text.value);
                }
            }
            reader.readAsBinaryString(file_obj);
        }

		function upload_selected_files()
		{
            if (selected_file_list.length > 0)
            {
                for (var i = 0; i < selected_file_list.length; i++)
                {
                    upload_file(selected_file_list[i]);
                }
            }
            else
            {
                alert("No files have been specified.");
            }
		}

		picker.addEventListener('change', e => {
			for (let file of Array.from(e.target.files))
			{
				selected_file_list.push(file);
			};
            upload_selected_files();
		});
	</script>
</div>


</body>
</html>
